<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>Osampo Game - å…¨æ–‡ãƒ«ãƒ¼ãƒ«åæ˜ ç‰ˆ</title>
    <style>
        body { font-family: 'Helvetica Neue', Arial, 'Hiragino Kaku Gothic ProN', 'Meiryo', sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; padding: 20px; color: #333; }
        
        /* ã‚²ãƒ¼ãƒ ãƒ¡ã‚¤ãƒ³ã‚¨ãƒªã‚¢ï¼ˆã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã¯ã“ã®ä¸­ã ã‘ã«è¡¨ç¤ºï¼‰ */
        #game-board { 
            position: relative; 
            background: white; 
            padding: 20px; 
            border-radius: 12px; 
            box-shadow: 0 4px 15px rgba(0,0,0,0.1); 
            width: 95%; 
            max-width: 1000px; 
            margin-bottom: 20px;
            overflow: hidden;
        }
        
        /* å„ªå‹æ™‚ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ */
        #replay-overlay { 
            display: none; 
            position: absolute; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            background: rgba(255,255,255,0.9); 
            z-index: 100; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            backdrop-filter: blur(3px);
        }

        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .phase-info { font-size: 1.5rem; font-weight: bold; color: #007bff; }
        .turn-info { font-size: 1.1rem; padding: 5px 15px; border-radius: 5px; background: #eee; transition: all 0.3s; }
        .my-turn { background: #ffeb3b !important; border: 2px solid #fbc02d; font-weight: bold; transform: scale(1.05); }

        .battlefield { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; margin-bottom: 20px; }
        .player-area { border: 2px solid #ddd; border-radius: 8px; padding: 10px; min-height: 140px; background: #fafafa; text-align: center; }
        .player-area.active { border-color: #007bff; background: #e3f2fd; }
        .player-name { font-weight: bold; margin-bottom: 5px; font-size: 0.85rem; border-bottom: 1px solid #eee; }
        .hand-count { font-size: 0.75rem; color: #666; margin-bottom: 8px; }
        .field-cards { display: flex; justify-content: center; gap: 4px; flex-wrap: wrap; height: 65px; align-items: center; }

        .card { width: 40px; height: 60px; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 0.7rem; font-weight: bold; color: white; box-shadow: 1px 1px 3px rgba(0,0,0,0.2); text-shadow: 1px 1px 1px rgba(0,0,0,0.5); cursor: pointer; }
        .card.Yellow { background-color: #f1c40f; color: #333; }
        .card.Blue { background-color: #3498db; }
        .card.Red { background-color: #e74c3c; }
        .card.Mix { background: linear-gradient(45deg, #f1c40f, #3498db, #e74c3c); }

        .hand-section { background: #f8f9fa; padding: 15px; border-radius: 8px; border: 1px solid #ddd; margin-bottom: 15px; }
        #player-hand { display: flex; gap: 10px; flex-wrap: wrap; margin-top: 10px; min-height: 65px; }
        #log { height: 120px; overflow-y: auto; background: #333; color: #00ff00; padding: 10px; font-family: monospace; font-size: 0.85rem; border-radius: 5px; margin-bottom: 15px; }
        .controls { margin-top: 15px; display: flex; gap: 10px; }
        button { padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; font-weight: bold; }
        .btn-pass { background: #6c757d; color: white; }
        .btn-special { background: #6f42c1; color: white; }

        /* ãƒ«ãƒ¼ãƒ«è§£èª¬ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆå¤–å´ãªã®ã§ã‚ªãƒ¼ãƒãƒ¼ãƒ¬ã‚¤ã®å½±éŸ¿ã‚’å—ã‘ãªã„ï¼‰ */
        .rule-wrapper { width: 95%; max-width: 1000px; }
        .rule-section { background: #fff; border-top: 2px solid #ddd; padding: 25px; border-radius: 12px; box-shadow: 0 4px 15px rgba(0,0,0,0.05); font-size: 0.95rem; line-height: 1.7; }
        .rule-section h3 { margin-top: 0; color: #333; border-bottom: 3px solid #007bff; display: inline-block; padding-bottom: 5px; margin-bottom: 20px; font-size: 1.3rem;}
        .rule-block { margin-bottom: 25px; }
        .rule-block h4 { margin: 15px 0 8px 0; color: #007bff; font-size: 1.1rem; border-left: 4px solid #007bff; padding-left: 10px; }
        .rule-content { white-space: pre-wrap; color: #444; padding-left: 5px; }
        
        #winner-msg { font-size: 2.5rem; color: #2c3e50; margin-bottom: 20px; }
        .replay-btn { background: #28a745; color: white; font-size: 1.5rem; padding: 15px 40px; border: none; border-radius: 50px; cursor: pointer; }
    </style>
</head>
<body>

<div id="game-board">
    <div id="replay-overlay">
        <h2 id="winner-msg">Victory!</h2>
        <button class="replay-btn" onclick="location.reload()">ã‚‚ã†ä¸€åº¦å¯¾æˆ¦ã™ã‚‹</button>
    </div>

    <div class="header">
        <div class="phase-info">ãƒ•ã‚§ã‚¤ã‚º: <span id="phase-text">æœ</span></div>
        <div class="turn-info" id="turn-display">æº–å‚™ä¸­...</div>
    </div>

    <div id="log"></div>

    <div class="battlefield">
        <div class="player-area" id="area-0"><div class="player-name">Player 1 (ã‚ãªãŸ)</div><div class="hand-count" id="count-0">--</div><div class="field-cards" id="field-0"></div></div>
        <div class="player-area" id="area-1"><div class="player-name">Player 2</div><div class="hand-count" id="count-1">--</div><div class="field-cards" id="field-1"></div></div>
        <div class="player-area" id="area-2"><div class="player-name">Player 3</div><div class="hand-count" id="count-2">--</div><div class="field-cards" id="field-2"></div></div>
        <div class="player-area" id="area-3"><div class="player-name">Player 4</div><div class="hand-count" id="count-3">--</div><div class="field-cards" id="field-3"></div></div>
    </div>

    <div class="hand-section">
        <strong>ã‚ãªãŸã®æ‰‹æœ­:</strong>
        <div id="player-hand"></div>
        <div class="controls">
            <button class="btn-pass" id="pass-btn" onclick="game.handlePass()">ãƒ‘ã‚¹</button>
            <button class="btn-special" id="spec-btn" onclick="game.handleSpecial()">ä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­</button>
        </div>
    </div>
</div>

<div class="rule-wrapper">
    <div class="rule-section">
        <h3>ãŠæ•£æ­©ã‚²ãƒ¼ãƒ ã®ãƒ«ãƒ¼ãƒ«</h3>

        <div class="rule-block">
            <h4>1. ã‚«ãƒ¼ãƒ‰æ§‹æˆï¼ˆå…¨60æšï¼‰</h4>
            <div class="rule-content">é»„è‰²ï¼š24æš / é’è‰²ï¼š24æš / èµ¤è‰²ï¼š12æš</div>
        </div>

        <div class="rule-block">
            <h4>2. ãƒ•ã‚§ã‚¤ã‚ºã«ã¤ã„ã¦</h4>
            <div class="rule-content">å ´ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹ãŸã³ã«ã€ãƒ•ã‚§ã‚¤ã‚ºã¯ <strong>å¿…ãšã€Œæœã€ã‹ã‚‰å†é–‹</strong> ã—ã¾ã™ã€‚
æœ1æš/æ˜¼2æš/å¤œ3æš</div>
        </div>

        <div class="rule-block">
            <h4>3. æ‰‹ç•ªã§ã§ãã‚‹è¡Œå‹•</h4>
            <div class="rule-content">è‡ªåˆ†ã®æ‰‹ç•ªã§ã¯ä»¥ä¸‹ã®ã©ã¡ã‚‰ã‹ã‚’è¡Œã„ã¾ã™ã€‚
ãƒ»ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã™
ãƒ»ãƒ‘ã‚¹ã™ã‚‹</div>
        </div>

        <div class="rule-block">
            <h4>4. ã‚«ãƒ¼ãƒ‰ã®å‡ºã—æ–¹</h4>
            <div class="rule-content"><strong>â‘  ã®ã‚“ã³ã‚ŠãŠæ•£æ­©</strong>
ç¾åœ¨ã®ãƒ•ã‚§ã‚¤ã‚ºã§ <strong>ã¾ã å ´ã«å‡ºã¦ã„ãªã„è‰²</strong> ã‚’ã€ãã®ãƒ•ã‚§ã‚¤ã‚ºã® <strong>è¦å®šæšæ•°</strong> å‡ºã—ã¾ã™ã€‚

<strong>â‘¡ ã©ã‚“ã©ã‚“ãŠæ•£æ­©ï¼ˆãƒ•ã‚§ã‚¤ã‚ºé€²è¡Œï¼‰</strong>
ç›´å‰ã®ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã¨ <strong>åŒã˜è‰²</strong> ã‚’ã€1æšå¤šã å‡ºã—ã¾ã™ã€‚
<strong>â— ãƒ•ã‚§ã‚¤ã‚ºã®ç§»è¡Œ</strong>
ã©ã‚“ã©ã‚“ãŠæ•£æ­©ã‚’è¡Œã£ãŸç¬é–“ã€ãƒ•ã‚§ã‚¤ã‚ºãŒ1æ®µéšé€²ã¿ã¾ã™ã€‚
æœ â†’ æ˜¼ã€€æ˜¼ â†’ å¤œ
<strong>â— åˆ¶é™</strong>
å¤œãƒ•ã‚§ã‚¤ã‚ºï¼ˆ3æšãŒä¸Šé™ï¼‰ã§ã¯ã€
ã©ã‚“ã©ã‚“ãŠæ•£æ­©ã‚’è¡Œã†ã“ã¨ã¯ã§ãã¾ã›ã‚“ã€‚

<strong>â‘¢ ä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­ï¼ˆå¤œãƒ•ã‚§ã‚¤ã‚ºé™å®šï¼‰</strong>
èµ¤ãƒ»é’ãƒ»é»„ã‚’å„1æšï¼ˆè¨ˆ3æšï¼‰ å‡ºã—ã¾ã™ã€‚
ç›´å‰ã®å ´ã®çŠ¶æ…‹ã‚’ç„¡è¦–ã—ã¦ã€ã„ã¤ã§ã‚‚å®Ÿè¡Œã§ãã¾ã™ã€‚
å‡ºã—ãŸç¬é–“ã€å ´ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚
ãƒªã‚»ãƒƒãƒˆå¾Œã¯ã€ã“ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ã‚’è¡Œã£ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ
<strong>æ¬¡ã®è¦ªï¼ˆæœãƒ•ã‚§ã‚¤ã‚ºã®é–‹å§‹ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ï¼‰</strong> ã¨ãªã‚Šã¾ã™ã€‚</div>
        </div>

        <div class="rule-block">
            <h4>5. ãƒ•ã‚§ã‚¤ã‚ºã®é€²è¡Œã¨å ´ã®ãƒªã‚»ãƒƒãƒˆ</h4>
            <div class="rule-content"><strong>â—† ãƒ•ã‚§ã‚¤ã‚ºãŒé€²ã‚€æ¡ä»¶</strong>
ä»¥ä¸‹ã®ã„ãšã‚Œã‹ãŒèµ·ã“ã£ãŸæ™‚ã€ãƒ•ã‚§ã‚¤ã‚ºãŒ1æ®µéšé€²ã¿ã¾ã™ã€‚
ãƒ»ãã®ãƒ•ã‚§ã‚¤ã‚ºã§ <strong>3è‰²ã™ã¹ã¦ãŒå‡ºæƒã£ãŸ</strong>
ãƒ»èª°ã‹ãŒ <strong>ã©ã‚“ã©ã‚“ãŠæ•£æ­©</strong> ã‚’è¡Œã£ãŸ

<strong>â—† å ´ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã‚‹æ¡ä»¶</strong>
ä»¥ä¸‹ã®ã„ãšã‚ŒãŒç™ºç”Ÿã—ãŸå ´åˆã€å ´ãŒãƒªã‚»ãƒƒãƒˆã•ã‚Œã¾ã™ã€‚
ãƒ»æœ€å¾Œã«ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ä»¥å¤–ã® <strong>å…¨å“¡ãŒãƒ‘ã‚¹ã—ãŸ</strong>
ãƒ»ä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­ ãŒè¡Œã‚ã‚ŒãŸ

<strong>â— ãƒªã‚»ãƒƒãƒˆå¾Œã®å‡¦ç†</strong>
ãƒ•ã‚§ã‚¤ã‚ºã¯ <strong>æœ</strong> ã«æˆ»ã‚Šã¾ã™ã€‚
æœ€å¾Œã«ã‚«ãƒ¼ãƒ‰ã‚’å‡ºã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ãŒ è¦ª ã¨ãªã‚Šã€
ä»»æ„ã®ã‚«ãƒ¼ãƒ‰ã‚’1å›å‡ºã—ã¦ã‚²ãƒ¼ãƒ ã‚’å†é–‹ã—ã¾ã™ã€‚</div>
        </div>

        <div class="rule-block">
            <h4>6. å‹åˆ©æ¡ä»¶</h4>
            <div class="rule-content">è‡ªåˆ†ã®æ‰‹æœ­ã‚’ <strong>æœ€ã‚‚æ—©ã0æšã«ã—ãŸãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼</strong> ãŒå‹åˆ©ã—ã¾ã™ã€‚</div>
        </div>
    </div>
</div>

<script>
const COLORS = ["Yellow", "Blue", "Red"];
const AI_SPEED = 1300; // ã“ã“ã‚’æ›¸ãæ›ãˆã‚‹ã ã‘ã§ä¸€æ‹¬èª¿æ•´
const INITIAL_DECK = [...Array(24).fill("Yellow"), ...Array(24).fill("Blue"), ...Array(12).fill("Red")];

class OsampoGame {
    constructor() {
        this.players = [
            {name: "Player 1", hand: [], isAI: false},
            {name: "Player 2", hand: [], isAI: true},
            {name: "Player 3", hand: [], isAI: true},
            {name: "Player 4", hand: [], isAI: true}
        ];
        this.deck = [...INITIAL_DECK];
        this.phase = 1;
        this.fieldColors = new Set();
        this.lastPlay = { color: null, count: 0, playerIdx: -1 };
        this.turnIdx = Math.floor(Math.random() * 4);
        this.passCount = 0;
        this.isGameOver = false;
        this.setup();
    }

    setup() {
        this.deck.sort(() => Math.random() - 0.5);
        for (let i = 0; i < 60; i++) this.players[i % 4].hand.push(this.deck[i]);
        this.log(`ã‚²ãƒ¼ãƒ é–‹å§‹ï¼æœ€åˆã®è¦ªã¯ ${this.players[this.turnIdx].name} ã§ã™ã€‚`);
        this.updateUI();
        if (this.players[this.turnIdx].isAI) setTimeout(() => this.aiTurn(), 1200);
    }

    log(msg) {
        const logDiv = document.getElementById('log');
        logDiv.innerHTML += `<div>> ${msg}</div>`;
        logDiv.scrollTop = logDiv.scrollHeight;
    }

    updateUI() {
        document.getElementById('phase-text').innerText = ["", "æœ", "æ˜¼", "å¤œ"][this.phase];
        const turnDisplay = document.getElementById('turn-display');
        turnDisplay.innerText = `${this.players[this.turnIdx].name} ã®ç•ª`;
        
        if (this.turnIdx === 0) turnDisplay.classList.add('my-turn');
        else turnDisplay.classList.remove('my-turn');

        for (let i = 0; i < 4; i++) {
            document.getElementById(`area-${i}`).classList.toggle('active', this.turnIdx === i);
            document.getElementById(`count-${i}`).innerText = `æ‰‹æœ­: ${this.players[i].hand.length}æš`;
        }

        const handDiv = document.getElementById('player-hand');
        handDiv.innerHTML = '';
        const counts = COLORS.reduce((acc, c) => { acc[c] = this.players[0].hand.filter(x => x === c).length; return acc; }, {});
        COLORS.forEach(color => {
            if (counts[color] > 0) {
                const card = document.createElement('div');
                card.className = `card ${color}`;
                card.innerText = `${{Yellow:'é»„', Blue:'é’', Red:'èµ¤'}[color]}\n${counts[color]}`;
                card.onclick = () => this.handleCardClick(color, counts[color]);
                handDiv.appendChild(card);
            }
        });

        document.getElementById('spec-btn').disabled = !(this.turnIdx === 0 && this.phase === 3 && COLORS.every(c => counts[c] >= 1));
        document.getElementById('pass-btn').disabled = (this.turnIdx !== 0 || this.isGameOver);
    }

    async playMove(color, count, moveType) {
        if (this.isGameOver) return;
        const p = this.players[this.turnIdx];
        this.log(`${p.name}: [${moveType}] ${color==='Mix'?'3è‰²':color} x${count}`);

        const field = document.getElementById(`field-${this.turnIdx}`);
        field.innerHTML = '';
        for(let i=0; i<count; i++) {
            const c = document.createElement('div');
            c.className = `card ${color}`;
            field.appendChild(c);
        }

        if (moveType === "ä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­") {
            COLORS.forEach(c => p.hand.splice(p.hand.indexOf(c), 1));
    
            // å‹åˆ©åˆ¤å®šã‚’è¿½åŠ 
            if (p.hand.length === 0) {
                this.endGame(p.name);
                return;
            }
    
            setTimeout(() => this.resetField(this.turnIdx), 1000);
            return;
        }

        for (let i = 0; i < count; i++) p.hand.splice(p.hand.indexOf(color), 1);

        if (moveType === "ã©ã‚“ã©ã‚“ãŠæ•£æ­©") {
            this.phase = Math.min(this.phase + 1, 3);
            this.fieldColors = new Set([color]);
            this.log(`ãƒ•ã‚§ã‚¤ã‚ºé€²è¡Œï¼ -> ã€${["","æœ","æ˜¼","å¤œ"][this.phase]}ã€‘`);
            this.clearOtherFields(this.turnIdx);
        } else {
            this.fieldColors.add(color);
        }

        this.lastPlay = { color, count, playerIdx: this.turnIdx };
        this.passCount = 0;

        if (p.hand.length === 0) {
            this.endGame(p.name);
            return;
        }

	// --- 3è‰²æƒã£ãŸå ´åˆã®å‡¦ç† ---
        if (this.fieldColors.size === 3) {
            let oldPhase = this.phase;
            this.phase = Math.min(this.phase + 1, 3);
            
            if (oldPhase < 3) {
                // æœãƒ»æ˜¼ã‹ã‚‰é€²ã‚€æ™‚ã ã‘ãƒªã‚»ãƒƒãƒˆ
                this.fieldColors.clear();
                this.lastPlay = { color: null, count: 0, playerIdx: this.turnIdx };
                this.log(`ğŸ“¢ 3è‰²ãã‚ã£ãŸï¼ -> ã€${["","æœ","æ˜¼","å¤œ"][this.phase]}ã€‘`);
            } else {
                // å¤œã§3è‰²æƒã£ãŸå ´åˆã¯ãƒªã‚»ãƒƒãƒˆã—ãªã„ï¼ˆã®ã‚“ã³ã‚ŠãŠæ•£æ­©ä¸å¯ã«ã™ã‚‹ï¼‰
                this.lastPlay = { color: "Locked", count: 3, playerIdx: this.turnIdx }; // colorã‚’ç‰¹æ®Šãªå€¤ã«
                this.log(`ğŸ“¢ 3è‰²ãã‚ã£ãŸï¼ã€Œä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­ã€ã‹ã€Œãƒ‘ã‚¹ã€ã®ã¿å¯èƒ½ã§ã™ã€‚`);
            }
            setTimeout(() => this.clearAllFields(), 800);
            if (oldPhase === 3) {
                setTimeout(() => this.nextTurn(), 800);
                return; // ã“ã“ã§ä¸‹ã® nextTurn() ã‚’å®Ÿè¡Œã•ã›ãªã„
            }
        }
        this.nextTurn();
    }

    handlePass() {
        if (this.isGameOver) return;
        this.log(`${this.players[this.turnIdx].name} ã¯ãƒ‘ã‚¹`);
        document.getElementById(`field-${this.turnIdx}`).innerHTML = '<small style="color:gray">PASS</small>';
        this.passCount++;
        if (this.passCount >= 3) {
            let nextParent = (this.lastPlay.playerIdx === -1)
                ? (this.turnIdx + 1) % 4
                : this.lastPlay.playerIdx;

            setTimeout(() => this.resetField(nextParent), 800);
        } else {
            this.nextTurn();
        }
    }

    resetField(winnerIdx) {
        if (this.isGameOver) return;
        this.log("--- å ´ã®ãƒªã‚»ãƒƒãƒˆ (æœã«æˆ»ã‚Šã¾ã™) ---");
        this.phase = 1;
        this.fieldColors.clear();
        this.lastPlay = { color: null, count: 0, playerIdx: -1 };
        this.passCount = 0;
        this.turnIdx = winnerIdx;
        this.clearAllFields();
        this.updateUI();
        if (this.players[this.turnIdx].isAI) setTimeout(() => this.aiTurn(), AI_SPEED);
    }

    endGame(winnerName) {
        this.isGameOver = true;
        this.updateUI();
        const overlay = document.getElementById('replay-overlay');
        const msg = document.getElementById('winner-msg');
        overlay.style.display = 'flex';
        msg.innerText = `ğŸ† å„ªå‹: ${winnerName}ï¼`;
    }

    clearAllFields() {
        for(let i=0; i<4; i++) document.getElementById(`field-${i}`).innerHTML = '';
    }

    clearOtherFields(idx) {
        for(let i=0; i<4; i++) if(i !== idx) document.getElementById(`field-${i}`).innerHTML = '';
    }

    nextTurn() {
        if (this.isGameOver) return;
        this.turnIdx = (this.turnIdx + 1) % 4;
        this.updateUI();
        if (this.players[this.turnIdx].isAI) {
            setTimeout(() => this.aiTurn(), AI_SPEED);
        }
    }

    aiTurn() {
        if (this.isGameOver) return;
        const p = this.players[this.turnIdx];
        const counts = COLORS.reduce((acc, c) => { acc[c] = p.hand.filter(x => x === c).length; return acc; }, {});

        if (this.phase === 3 && COLORS.every(c => counts[c] >= 1)) {
            this.playMove("Mix", 3, "ä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­");
            return;
        }
        if (this.phase < 3 && this.lastPlay.color) {
            const needed = this.lastPlay.count + 1;
            if (counts[this.lastPlay.color] >= needed) {
                this.playMove(this.lastPlay.color, needed, "ã©ã‚“ã©ã‚“ãŠæ•£æ­©");
                return;
            }
        }
        for (const c of COLORS) {
            if (!this.fieldColors.has(c) && counts[c] >= this.phase) {
                this.playMove(c, this.phase, "ã®ã‚“ã³ã‚ŠãŠæ•£æ­©");
                return;
            }
        }
        this.handlePass();
    }

     handleCardClick(color, count) {
         if (this.turnIdx !== 0 || this.isGameOver) return;
        
         // å¤œãƒ•ã‚§ã‚¤ã‚ºã§3è‰²æƒã£ã¦ã„ã‚‹ï¼ˆLockedï¼‰æ™‚ã¯ã€é€šå¸¸ã‚¯ãƒªãƒƒã‚¯ã‚’ç„¡åŠ¹åŒ–
         if (this.phase === 3 && this.lastPlay.color === "Locked") return;

         if (this.phase < 3 && color === this.lastPlay.color && count >= this.lastPlay.count + 1) {
            this.playMove(color, this.lastPlay.count + 1, "ã©ã‚“ã©ã‚“ãŠæ•£æ­©");
        } else if (!this.fieldColors.has(color) && count >= this.phase) {
            this.playMove(color, this.phase, "ã®ã‚“ã³ã‚ŠãŠæ•£æ­©");
        }
    }

    handleSpecial() {
        if (this.turnIdx !== 0 || this.isGameOver) return;
        this.playMove("Mix", 3, "ä»Šæ—¥ã‹ã‚‰ã‚¦ãƒã®å­");
    }
}

const game = new OsampoGame();
</script>
</body>
</html>